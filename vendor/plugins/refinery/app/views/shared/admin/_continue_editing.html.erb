<% unless f.object.new_record? -%>
  <%= hidden_field_tag :continue_editing, false %>
  <%= f.submit 'Save &amp; Continue Editing', :id => "submit_continue_button", :class => "wymupdate" %>
  <% content_for :head do -%>
    <script type='text/javascript'>
      FastInit.addOnLoad(function() {
        if ($('submit_continue_button') != null) {
          $('submit_continue_button').observe("click", function(e) {
            $('continue_editing').value = true;

            if ((flash=$('flash')) != null) {
              flash.hide();
            }

            new Ajax.Request(this.form.action, {
              method: this.form.method
              , parameters: this.form.serialize()
              , onComplete: function(e) {
                if ((flash_container = $('flash_container')) != null) {

                  flash_container.update(e.transport.responseText);

                  if ((flash = $('flash')) != null) {
                    flash.style.width = 'auto';
                    flash.appear();
                  }

                  $$('#errorExplanation').each(function(errorExplanation) {
                    if (errorExplanation.parentNode.id != 'flash_container') {
                      errorExplanation.remove();
                    }
                  });

                  $$('.fieldWithErrors').each(function(field) {
                    field.removeClassName('fieldWithErrors').addClassName('field');
                  });

                  flash_container.scrollTo();
                  $('continue_editing').value = false;
                }
              }
              , evalScripts: true
            });

            e.preventDefault();
          });
        }
      });
    </script>
  <% end -%>
<% end -%>
