<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=UTF-8" />
<title>Module: Crud::ClassMethods</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo; 
    <span class='title'><a href="../Crud.html" title="Crud (module)">Crud</a></span>
     &raquo; 
    <span class="title">ClassMethods</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Crud::ClassMethods 
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">vendor/plugins/refinery/lib/crud.rb</dd>
  
</dl>
<div class="clear"></div>




  <h2>Instance Method Summary</h2>

  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#crudify-instance_method" title="#crudify (instance method)">- (Object) <strong>crudify</strong>(model_name, new_options = {}) </a>
    

    
  </span>
  
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
  </ul>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="crudify-instance_method">
  
    - (<tt>Object</tt>) <strong>crudify</strong>(model_name, new_options = {}) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/plugins/refinery/lib/crud.rb', line 20</span>

<span class='def def kw'>def</span> <span class='crudify identifier id'>crudify</span><span class='lparen token'>(</span><span class='model_name identifier id'>model_name</span><span class='comma token'>,</span> <span class='new_options identifier id'>new_options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:title_attribute</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;title&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'position ASC'</span><span class='comma token'>,</span>
    <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>''</span><span class='comma token'>,</span>
    <span class='symbol val'>:sortable</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span>
    <span class='symbol val'>:searchable</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span>
    <span class='symbol val'>:include</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='symbol val'>:paging</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span>
    <span class='symbol val'>:search_conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>''</span>
  <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='new_options identifier id'>new_options</span><span class='rparen token'>)</span>

  <span class='singular_name identifier id'>singular_name</span> <span class='assign token'>=</span> <span class='model_name identifier id'>model_name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='class_name identifier id'>class_name</span> <span class='assign token'>=</span> <span class='singular_name identifier id'>singular_name</span><span class='dot token'>.</span><span class='camelize identifier id'>camelize</span>
  <span class='plural_name identifier id'>plural_name</span> <span class='assign token'>=</span> <span class='singular_name identifier id'>singular_name</span><span class='dot token'>.</span><span class='pluralize identifier id'>pluralize</span>

  <span class='module_eval identifier id'>module_eval</span> <span class='dstring node'>%(
    before_filter :find_#{singular_name}, :only =&gt; [:update, :destroy, :edit]

    def new
      @#{singular_name} = #{class_name}.new
    end

    def create
      # if the position field exists, set this object as last object, given the conditions of this class.
      if #{class_name}.column_names.include?(&quot;position&quot;)
        params[:#{singular_name}].merge!({:position =&gt; #{class_name}.maximum(:position, :conditions =&gt; &quot;#{options[:conditions]}&quot;)})
      end

      if (@#{singular_name} = #{class_name}.create(params[:#{singular_name}])).valid?
        unless request.xhr?
          flash[:notice] = &quot;'\#{@#{singular_name}.#{options[:title_attribute]}}' was successfully created.&quot;
        else
          flash.now[:notice] = &quot;'\#{@#{singular_name}.#{options[:title_attribute]}}' was successfully created.&quot;
        end
        unless params[:continue_editing] =~ /true|on|1/
          redirect_to admin_#{plural_name}_url
        else
          unless request.xhr?
            redirect_to :back
          else
            render :partial =&gt; &quot;/shared/message&quot;
          end
        end
      else
        unless request.xhr?
          render :action =&gt; 'new'
        else
          render :partial =&gt; &quot;/shared/admin/error_messages_for&quot;, :locals =&gt; {:symbol =&gt; :#{singular_name}, :object =&gt; @#{singular_name}}
        end
      end
    end

    def edit
      @#{singular_name} = #{class_name}.find(params[:id])
    end

    def update
      if @#{singular_name}.update_attributes(params[:#{singular_name}])
        unless request.xhr?
          flash[:notice] = &quot;'\#{@#{singular_name}.#{options[:title_attribute]}}' was successfully updated.&quot;
        else
          flash.now[:notice] = &quot;'\#{@#{singular_name}.#{options[:title_attribute]}}' was successfully updated.&quot;
        end
        unless params[:continue_editing] =~ /true|on|1/
          redirect_to admin_#{plural_name}_url
        else
          unless request.xhr?
            redirect_to :back
          else
            render :partial =&gt; &quot;/shared/message&quot;
          end
        end
      else
        unless request.xhr?
          render :action =&gt; 'edit'
        else
          render :partial =&gt; &quot;/shared/admin/error_messages_for&quot;, :locals =&gt; {:symbol =&gt; :#{singular_name}, :object =&gt; @#{singular_name}}
        end
      end
    end

    def destroy
      flash[:notice] = &quot;'\#{@#{singular_name}.#{options[:title_attribute]}}' was successfully deleted.&quot; if @#{singular_name}.destroy
      redirect_to admin_#{plural_name}_url
    end

    def find_#{singular_name}
      @#{singular_name} = #{class_name}.find(params[:id], :include =&gt; %w(#{options[:include].join(' ')}))
    end

    def find_all_#{plural_name}
      @#{plural_name} = #{class_name}.find  :all,
                                            :order =&gt; &quot;#{options[:order]}&quot;,
                                            :conditions =&gt; &quot;#{options[:conditions]}&quot;,
                                            :include =&gt; %w(#{options[:include].join(' ')})
    end

    def paginate_all_#{plural_name}
      @#{plural_name} = #{class_name}.paginate :page =&gt; params[:page],
                                               :order =&gt; &quot;#{options[:order]}&quot;,
                                               :conditions =&gt; &quot;#{options[:conditions]}&quot;,
                                               :include =&gt; %w(#{options[:include].join(' ')})
    end

    def search_all_#{plural_name}
      @#{plural_name} = #{class_name}.find_with_index params[:search],
                                               :order =&gt; &quot;#{options[:order]}&quot;,
                                               :conditions =&gt; &quot;#{options[:search_conditions]}&quot;,
                                               :include =&gt; %w(#{options[:include].join(' ')})
    end

    def search_and_paginate_all_#{plural_name}
      @#{plural_name} = #{class_name}.paginate_search params[:search],
                                               :page =&gt; params[:page],
                                               :order =&gt; &quot;#{options[:order]}&quot;,
                                               :conditions =&gt; &quot;#{options[:search_conditions]}&quot;,
                                               :include =&gt; %w(#{options[:include].join(' ')})
    end

    protected :find_#{singular_name}, :find_all_#{plural_name}, :paginate_all_#{plural_name}, :search_all_#{plural_name}, :search_and_paginate_all_#{plural_name}

  )</span>

  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:searchable</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:paging</span><span class='rbrack token'>]</span>
      <span class='module_eval identifier id'>module_eval</span> <span class='dstring node'>%(
        def index
          if searching?
            search_and_paginate_all_#{plural_name}
          else
            paginate_all_#{plural_name}
          end
        end
      )</span>
    <span class='else else kw'>else</span>
      <span class='module_eval identifier id'>module_eval</span> <span class='dstring node'>%(
        def index
          if searching?
            search_all_#{plural_name}
          else
            find_all_#{plural_name}
          end
        end
      )</span>
    <span class='end end kw'>end</span>

  <span class='else else kw'>else</span>
    <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:paging</span><span class='rbrack token'>]</span>
      <span class='module_eval identifier id'>module_eval</span> <span class='dstring node'>%(
        def index
          paginate_all_#{plural_name}
        end
      )</span>
    <span class='else else kw'>else</span>
      <span class='module_eval identifier id'>module_eval</span> <span class='dstring node'>%(
        def index
          find_all_#{plural_name}
        end
      )</span>
    <span class='end end kw'>end</span>

  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:sortable</span><span class='rbrack token'>]</span>
    <span class='module_eval identifier id'>module_eval</span> <span class='dstring node'>%(
      def reorder
        find_all_#{plural_name}
      end

      def update_positions
        unless params[:tree] == &quot;true&quot;
          params[:sortable_list].each do |i|
            #{class_name}.find(i).update_attribute(:position, params[:sortable_list].index(i))
          end
        else
          params[:sortable_list].each do |position, id_hash|
            parse_branch(position, id_hash, nil)
          end
        end

        find_all_#{plural_name}
        render :partial =&gt; 'sortable_list', :layout =&gt; false
      end

      # takes in a single branch and saves the nodes inside it
      def parse_branch(position, id_hash, parent_id)
        id_hash.each do |pos, id|
          parse_branch(pos, id, id_hash[&quot;id&quot;]) unless pos == &quot;id&quot;
        end if id_hash.include?('0')

        #{class_name}.update(id_hash[&quot;id&quot;], :parent_id =&gt; parent_id, :position =&gt; position)
      end

      protected :parse_branch
    )</span>
  <span class='end end kw'>end</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Wed 20 Jan 14:32:51 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.5.3 (ruby-1.8.7).
</div>

  </body>
</html>